<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMEA Lüks Markalar İş Geliştirme Raporu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-group select {
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .data-controls {
            display: flex;
            gap: 1rem;
            margin-left: auto;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.875rem;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            cursor: pointer;
            position: relative;
        }

        th:hover {
            background: #e9ecef;
        }

        th.sortable::after {
            content: ' ↕';
            position: absolute;
            right: 8px;
            opacity: 0.5;
        }

        th.sort-asc::after {
            content: ' ↑';
            opacity: 1;
        }

        th.sort-desc::after {
            content: ' ↓';
            opacity: 1;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .brand-name {
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
        }

        .brand-name:hover {
            color: #5a67d8;
            text-decoration: underline;
        }

        .expansion-rating {
            display: inline-block;
            font-size: 1.2rem;
        }

        .contact-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .contact-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
        }

        .contact-indicator.has-contact {
            background: #28a745;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow: hidden;
            position: relative;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }

        .close-btn:hover {
            color: #dc3545;
        }

        .modal-body {
            padding: 1.5rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .contact-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .contact-card h4 {
            margin-bottom: 0.5rem;
            color: #667eea;
        }

        .contact-meta {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 0.5rem;
        }

        .notes-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e9ecef;
        }

        .notes-section textarea {
            min-height: 100px;
            resize: vertical;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b8daff;
        }

        .file-input {
            margin-bottom: 1rem;
        }

        .file-input input[type="file"] {
            display: none;
        }

        .file-input-label {
            display: inline-block;
            padding: 10px 16px;
            background: #f8f9fa;
            border: 1px solid #ced4da;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .file-input-label:hover {
            background: #e9ecef;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .data-controls {
                margin-left: 0;
                margin-top: 1rem;
            }

            .filter-group {
                justify-content: center;
            }

            .modal-content {
                width: 95%;
                margin: 2% auto;
            }

            th, td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>EMEA Lüks Markalar</h1>
            <p>İş Geliştirme ve Strateji Raporu</p>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Marka, kategori veya şirket adına göre ara..." onkeyup="filterTable()">
            </div>
            
            <div class="filter-group">
                <select id="categoryFilter" onchange="filterTable()">
                    <option value="">Tüm Kategoriler</option>
                    <option value="Automotive">Otomotiv</option>
                    <option value="Fashion & Apparel">Moda & Hazır Giyim</option>
                    <option value="Jewelry & Watches">Mücevher & Saat</option>
                    <option value="Cosmetics & Fragrances">Kozmetik & Parfüm</option>
                </select>
                
                <select id="expansionFilter" onchange="filterTable()">
                    <option value="">Tüm Aktivite Seviyeleri</option>
                    <option value="5">⭐⭐⭐⭐⭐ Çok Yüksek</option>
                    <option value="4">⭐⭐⭐⭐ Yüksek</option>
                    <option value="3">⭐⭐⭐ Orta</option>
                    <option value="2">⭐⭐ Düşük</option>
                    <option value="1">⭐ Çok Düşük</option>
                </select>
            </div>

            <div class="data-controls">
                <button class="btn btn-secondary btn-sm" onclick="exportData()">📊 Verileri Dışa Aktar</button>
                <button class="btn btn-primary btn-sm" onclick="importData()">📂 Verileri İçe Aktar</button>
                <button class="btn btn-success btn-sm" onclick="clearAllData()">🔄 Verileri Sıfırla</button>
            </div>
        </div>

        <div class="table-container">
            <table id="brandsTable">
                <thead>
                    <tr>
                        <th class="sortable" onclick="sortTable(0)">Marka</th>
                        <th class="sortable" onclick="sortTable(1)">Kategori</th>
                        <th class="sortable" onclick="sortTable(2)">Ana Şirket</th>
                        <th class="sortable" onclick="sortTable(3)">Genişleme</th>
                        <th class="sortable" onclick="sortTable(4)">Mağaza Sayısı</th>
                        <th>Kontak & Notlar</th>
                    </tr>
                </thead>
                <tbody id="brandsTableBody">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Brand Detail Modal -->
    <div id="brandDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Marka Detayları</div>
                <button class="close-btn" onclick="closeModal('brandDetailModal')">&times;</button>
            </div>
            <div class="modal-body" id="brandDetailBody">
                <!-- Brand details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">İletişim Bilgileri</div>
                <button class="close-btn" onclick="closeModal('contactModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="contactsList"></div>
                <button class="btn btn-primary" onclick="showAddContactForm()">+ Yeni Kontak Ekle</button>
                
                <div id="addContactForm" style="display: none;">
                    <hr style="margin: 1.5rem 0;">
                    <h4>Yeni İletişim Bilgisi</h4>
                    <div class="form-group">
                        <label class="form-label">İsim Soyisim</label>
                        <input type="text" class="form-control" id="contactName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pozisyon</label>
                        <input type="text" class="form-control" id="contactTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">E-posta</label>
                        <input type="email" class="form-control" id="contactEmail">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefon</label>
                        <input type="tel" class="form-control" id="contactPhone">
                    </div>
                    <div class="form-group">
                        <label class="form-label">LinkedIn</label>
                        <input type="url" class="form-control" id="contactLinkedin" placeholder="https://linkedin.com/in/...">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-success" onclick="saveContact()">Kaydet</button>
                        <button class="btn btn-secondary" onclick="hideAddContactForm()">İptal</button>
                    </div>
                </div>

                <div class="notes-section">
                    <h4>Notlar</h4>
                    <textarea class="form-control" id="brandNotes" placeholder="Marka hakkında notlarınız..."></textarea>
                    <button class="btn btn-primary" onclick="saveNotes()" style="margin-top: 1rem;">Notları Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Import/Export Modal -->
    <div id="dataModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Veri Yönetimi</div>
                <button class="close-btn" onclick="closeModal('dataModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="dataModalContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Google Drive Configuration - Simplified
        const GOOGLE_DRIVE_CONFIG = {
            // Google Drive klasör ID'si (URL'den alınır)
            folderId: '1BdL3AADF-ExntZEICnGCuAR1KNXtBkLQ',
            
            // Dosya ID'leri (Google Drive'dan alındı)
            files: {
                contacts: '1rHrVbYLtBOW4EjDH4OHw9dQi5Iw7ZNUG',
                notes: '1AH9n5IDGcX4bF9yzVPOb7Vgc1QY9-fpc',
                brandDetails: '1xmJN-LRqgFzlskwKTtYR7qE_fOI_NJSc'
            },
            
            // Genel ayarlar
            enabled: true, // Tekrar aktif - CORS hatası çözüldü
            autoSync: true,
            syncInterval: 60000, // 60 saniye
            
            // Google Drive API URL'leri
            apiKey: 'AIzaSyDummy', // Geçici - gerçek API key gerekecek
            baseUrl: 'https://www.googleapis.com/drive/v3'
        };

        // Google Drive API Helper
        class GoogleDriveSync {
            constructor() {
                this.isOnline = navigator.onLine;
                this.currentUser = this.getCurrentUser();
                this.lastSync = new Date().toISOString();
                this.syncInProgress = false;
                this.accessToken = null;
                this.isSignedIn = false;
            }

            getCurrentUser() {
                let user = localStorage.getItem('currentUser');
                if (!user) {
                    user = prompt('Lütfen adınızı ve soyadınızı girin (örn: Ahmet Yılmaz):') || 'Anonim Kullanıcı';
                    localStorage.setItem('currentUser', user);
                }
                return user;
            }

            async syncContacts() {
                if (this.syncInProgress) return;
                this.syncInProgress = true;

                try {
                    // SharePoint'ten veri çek
                    const remoteData = await this.fetchRemoteContacts();
                    const localData = JSON.parse(localStorage.getItem('brandContacts') || '{}');
                    
                    // Merge verileri
                    const mergedData = this.mergeContacts(localData, remoteData);
                    
                    // Hem local hem remote'u güncelle
                    localStorage.setItem('brandContacts', JSON.stringify(mergedData));
                    await this.saveRemoteContacts(mergedData);
                    
                    this.showSyncStatus('success', 'Veriler senkronize edildi');
                    return mergedData;
                } catch (error) {
                    console.log('Sync failed, using local data:', error);
                    this.showSyncStatus('error', 'Senkronizasyon hatası - Lokal veri kullanılıyor');
                    return JSON.parse(localStorage.getItem('brandContacts') || '{}');
                } finally {
                    this.syncInProgress = false;
                }
            }

            async syncNotes() {
                if (this.syncInProgress) return;
                this.syncInProgress = true;

                try {
                    const remoteData = await this.fetchRemoteNotes();
                    const localData = JSON.parse(localStorage.getItem('brandNotes') || '{}');
                    
                    const mergedData = this.mergeNotes(localData, remoteData);
                    
                    localStorage.setItem('brandNotes', JSON.stringify(mergedData));
                    await this.saveRemoteNotes(mergedData);
                    
                    return mergedData;
                } catch (error) {
                    console.log('Notes sync failed:', error);
                    return JSON.parse(localStorage.getItem('brandNotes') || '{}');
                } finally {
                    this.syncInProgress = false;
                }
            }

            async authenticateGoogle() {
                try {
                    // Google API'yi yükle
                    if (!window.gapi) {
                        await this.loadGoogleAPI();
                    }
                    
                    // Google Auth'u başlat
                    await gapi.load('auth2', async () => {
                        const authInstance = await gapi.auth2.init({
                            client_id: GOOGLE_DRIVE_CONFIG.clientId,
                            scope: 'https://www.googleapis.com/auth/drive.file'
                        });
                        
                        if (!authInstance.isSignedIn.get()) {
                            await authInstance.signIn();
                        }
                        
                        this.isSignedIn = true;
                        this.accessToken = authInstance.currentUser.get().getAuthResponse().access_token;
                        console.log('Google Drive authenticated successfully');
                    });
                    
                    return true;
                } catch (error) {
                    console.error('Google authentication error:', error);
                    return false;
                }
            }

            async loadGoogleAPI() {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = 'https://apis.google.com/js/api.js';
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }

            async fetchRemoteContacts() {
                try {
                    // Google Drive dosyasını public link ile oku
                    const fileId = GOOGLE_DRIVE_CONFIG.files.contacts;
                    
                    // Google Drive public file URL formatı
                    const publicUrl = `https://drive.google.com/uc?id=${fileId}&export=download`;
                    
                    const response = await fetch(publicUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Cache-Control': 'no-cache'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('Google Drive contacts loaded:', data);
                        return data.contacts || {};
                    } else {
                        console.log('Google Drive response not ok:', response.status, response.statusText);
                    }
                    
                    return {};
                } catch (error) {
                    console.log('Google Drive contacts fetch error:', error);
                    this.showSyncStatus('error', 'Google Drive bağlantısı başarısız - Local veri kullanılıyor');
                    return {};
                }
            }

            async fetchRemoteNotes() {
                try {
                    // Google Drive dosyasını public link ile oku
                    const fileId = GOOGLE_DRIVE_CONFIG.files.notes;
                    
                    // Google Drive public file URL formatı
                    const publicUrl = `https://drive.google.com/uc?id=${fileId}&export=download`;
                    
                    const response = await fetch(publicUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Cache-Control': 'no-cache'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('Google Drive notes loaded:', data);
                        return data.notes || {};
                    } else {
                        console.log('Google Drive notes response not ok:', response.status, response.statusText);
                    }
                    
                    return {};
                } catch (error) {
                    console.log('Google Drive notes fetch error:', error);
                    this.showSyncStatus('error', 'Google Drive notlar yüklenemedi - Local veri kullanılıyor');
                    return {};
                }
            }

            async saveRemoteContacts(data) {
                try {
                    // Google Drive'a kaydetme şimdilik devre dışı
                    // Gelecekte Google Apps Script ile web app yapılacak
                    console.log('Google Drive save contacts - Development mode');
                    
                    const updatedData = {
                        metadata: {
                            version: "1.0",
                            lastSync: new Date().toISOString(),
                            lastModifiedBy: this.currentUser
                        },
                        contacts: data,
                        activity: [{
                            user: this.currentUser,
                            action: 'save_contacts',
                            timestamp: new Date().toISOString()
                        }]
                    };
                    
                    // Console'da JSON formatında göster - manuel yedekleme için
                    console.log('Contacts JSON for manual backup:');
                    console.log(JSON.stringify(updatedData, null, 2));
                    
                    this.showSyncStatus('info', 'Google Drive save: Development mode');
                    return true;
                } catch (error) {
                    console.error('Google Drive contacts save error:', error);
                    return false;
                }
            }

            async saveRemoteNotes(data) {
                try {
                    // Google Drive'a kaydetme şimdilik devre dışı
                    console.log('Google Drive save notes - Development mode');
                    
                    const updatedData = {
                        metadata: {
                            version: "1.0",
                            lastSync: new Date().toISOString(),
                            lastModifiedBy: this.currentUser
                        },
                        notes: data,
                        activity: [{
                            user: this.currentUser,
                            action: 'save_notes',
                            timestamp: new Date().toISOString()
                        }]
                    };
                    
                    // Console'da JSON formatında göster - manuel yedekleme için
                    console.log('Notes JSON for manual backup:');
                    console.log(JSON.stringify(updatedData, null, 2));
                    
                    this.showSyncStatus('info', 'Google Drive save: Development mode');
                    return true;
                } catch (error) {
                    console.error('Google Drive notes save error:', error);
                    return false;
                }
            }


            mergeContacts(local, remote) {
                const merged = { ...local };
                
                Object.keys(remote).forEach(brand => {
                    if (!merged[brand]) {
                        merged[brand] = remote[brand];
                    } else {
                        // En son güncelleme kazanır
                        const localTime = new Date(merged[brand].lastModified || 0);
                        const remoteTime = new Date(remote[brand].lastModified || 0);
                        
                        if (remoteTime > localTime) {
                            merged[brand] = remote[brand];
                        }
                    }
                });
                
                return merged;
            }

            mergeNotes(local, remote) {
                const merged = { ...local };
                
                Object.keys(remote).forEach(brand => {
                    if (!merged[brand] || new Date(remote[brand].lastModified || 0) > new Date(merged[brand].lastModified || 0)) {
                        merged[brand] = remote[brand];
                    }
                });
                
                return merged;
            }

            showSyncStatus(type, message) {
                const statusEl = document.getElementById('syncStatus') || this.createSyncStatusElement();
                statusEl.className = `sync-status ${type}`;
                statusEl.textContent = message;
                statusEl.style.display = 'block';
                
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            }

            createSyncStatusElement() {
                const statusEl = document.createElement('div');
                statusEl.id = 'syncStatus';
                statusEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 10px 20px;
                    border-radius: 6px;
                    z-index: 2000;
                    font-weight: 600;
                    display: none;
                `;
                document.body.appendChild(statusEl);
                
                // CSS ekle
                const style = document.createElement('style');
                style.textContent = `
                    .sync-status.success {
                        background: #d4edda;
                        color: #155724;
                        border: 1px solid #c3e6cb;
                    }
                    .sync-status.error {
                        background: #f8d7da;
                        color: #721c24;
                        border: 1px solid #f5c6cb;
                    }
                    .sync-status.info {
                        background: #cce7ff;
                        color: #004085;
                        border: 1px solid #b8daff;
                    }
                `;
                document.head.appendChild(style);
                
                return statusEl;
            }

            startAutoSync() {
                if (SHAREPOINT_CONFIG.autoSync) {
                    setInterval(() => {
                        this.syncContacts();
                        this.syncNotes();
                    }, SHAREPOINT_CONFIG.syncInterval);
                }
            }
        }

        // Global Google Drive instance
        const googleDriveSync = new GoogleDriveSync();

        // Data structure
        const brandData = [
            { name: 'Porsche', category: 'Automotive', parent: 'Volkswagen Group', expansion: 5, stores: 'Yüzlerce' },
            { name: 'Chanel', category: 'Fashion & Apparel', parent: 'Chanel Ltd.', expansion: 4, stores: '80+' },
            { name: 'Louis Vuitton', category: 'Fashion & Apparel', parent: 'LVMH', expansion: 5, stores: 'N/A' },
            { name: 'Hermès', category: 'Fashion & Apparel', parent: 'Hermès International S.A.', expansion: 3, stores: '190+' },
            { name: 'Rolex', category: 'Jewelry & Watches', parent: 'Rolex SA', expansion: 4, stores: 'Yetkili Satıcılar' },
            { name: 'Dior', category: 'Fashion & Apparel', parent: 'LVMH', expansion: 4, stores: '243' },
            { name: 'Cartier', category: 'Jewelry & Watches', parent: 'Richemont', expansion: 3, stores: 'N/A' },
            { name: 'Ferrari', category: 'Automotive', parent: 'Ferrari N.V.', expansion: 3, stores: '111+' },
            { name: 'Gucci', category: 'Fashion & Apparel', parent: 'Kering', expansion: 4, stores: '167+' },
            { name: 'Guerlain', category: 'Cosmetics & Fragrances', parent: 'LVMH', expansion: 3, stores: 'Butikler + Tezgahlar' },
            { name: 'Prada', category: 'Fashion & Apparel', parent: 'Prada Group', expansion: 4, stores: '220' },
            { name: 'Burberry', category: 'Fashion & Apparel', parent: 'Burberry Group plc', expansion: 3, stores: '244' },
            { name: 'Giorgio Armani', category: 'Fashion & Apparel', parent: 'Giorgio Armani S.p.A.', expansion: 3, stores: 'N/A' },
            { name: 'Patek Philippe', category: 'Jewelry & Watches', parent: 'Patek Philippe SA', expansion: 2, stores: 'Yetkili Satıcılar' },
            { name: 'Bottega Veneta', category: 'Fashion & Apparel', parent: 'Kering', expansion: 3, stores: 'N/A' },
            { name: 'Sandro', category: 'Fashion & Apparel', parent: 'SMCP', expansion: 4, stores: '1000+' },
            { name: 'Maje', category: 'Fashion & Apparel', parent: 'SMCP', expansion: 4, stores: 'SMCP Grubu' },
            { name: 'ba&sh', category: 'Fashion & Apparel', parent: 'L Catterton', expansion: 4, stores: '120+' },
            { name: 'Reiss', category: 'Fashion & Apparel', parent: 'Next plc', expansion: 2, stores: 'N/A' },
            { name: 'Massimo Dutti', category: 'Fashion & Apparel', parent: 'Inditex', expansion: 3, stores: 'N/A' },
            { name: 'Michael Kors', category: 'Fashion & Apparel', parent: 'Capri Holdings', expansion: 2, stores: '156' },
            { name: 'Nanushka', category: 'Fashion & Apparel', parent: '-', expansion: 2, stores: '2+' },
            { name: 'Bouguessa', category: 'Fashion & Apparel', parent: '-', expansion: 2, stores: '9' },
            { name: 'Bil Arabi', category: 'Jewelry & Watches', parent: '-', expansion: 2, stores: 'N/A' },
            { name: 'Palmeurah', category: 'Fashion & Apparel', parent: '-', expansion: 2, stores: 'N/A' }
        ];

        // Local storage management
        let contactsData = JSON.parse(localStorage.getItem('brandContacts') || '{}');
        let notesData = JSON.parse(localStorage.getItem('brandNotes') || '{}');
        let brandDetailsData = {
            "Porsche": {
                "title": "Porsche - İş Geliştirme Analizi",
                "content": {
                    "ozet": {
                        "kategori": "Otomotiv",
                        "anaShirket": "Volkswagen Group",
                        "emeaVarligi": "Almanya, İngiltere, BAE, Fransa, İtalya, İspanya, İsviçre",
                        "genislemeAktivitesi": 5,
                        "aciklama": "Çok Yüksek"
                    },
                    "magazaGelistirmeStratejisi": {
                        "konsept": "Destination Porsche Konsepti",
                        "ortalamaButukluk": "2,000-4,000 m²",
                        "yatirimTutari": "€5-15 milyon (lokasyona göre)",
                        "anaOzellikler": [
                            "Alüminyum cephe sistemleri",
                            "Modüler iç mekan tasarımı",
                            "Dijital deneyim alanları",
                            "VIP lounge ve kafe alanları",
                            "Servis alanı görünürlüğü"
                        ],
                        "constructionFirsatlari": [
                            "Premium ahşap ve metal işçiliği",
                            "Özel üretim display sistemleri",
                            "Akustik panel sistemleri",
                            "Lüks lounge mobilyaları",
                            "Dijital ekran entegrasyonları"
                        ]
                    },
                    "emeaGenisleme": {
                        "aktifProjeler": [
                            {
                                "sehir": "Milano, İtalya",
                                "proje": "Yeni konsept mağaza",
                                "tarih": "Q2 2024"
                            },
                            {
                                "sehir": "Varşova, Polonya",
                                "proje": "Destination Porsche",
                                "tarih": "Q3 2024"
                            },
                            {
                                "sehir": "Dubai, BAE",
                                "proje": "Flagship genişleme",
                                "tarih": "Q4 2024"
                            }
                        ],
                        "tamamlananProjeler": [
                            "Reading, UK (Ekim 2022) - İlk UK Destination Porsche",
                            "Limassol, Kıbrıs (Mayıs 2023)",
                            "Tunis, Tunus (Ocak 2025)"
                        ]
                    },
                    "kararVericiler": {
                        "magazaPlanlama": [
                            {
                                "isim": "Iryna Kauk",
                                "pozisyon": "VP Avrupa Bölgesi",
                                "odak": "Perakende Ağ Geliştirme"
                            },
                            {
                                "isim": "Rainer Schroll",
                                "pozisyon": "Yönetim Kurulu Üyesi, Perakende",
                                "sirket": "Porsche Holding Salzburg"
                            }
                        ]
                    },
                    "isPotansiyeli": {
                        "puan": "9/10",
                        "kriterler": [
                            "Agresif genişleme planları",
                            "Yüksek kalite standartları",
                            "Premium bütçe seviyeleri",
                            "Uzun vadeli ortaklık potansiyeli"
                        ]
                    }
                }
            },
            "Chanel": {
                "title": "Chanel - İş Geliştirme Analizi",
                "content": {
                    "ozet": {
                        "kategori": "Moda & Hazır Giyim",
                        "anaShirket": "Chanel Ltd. (Bağımsız)",
                        "emeaVarligi": "Fransa, İngiltere, BAE, İtalya, Almanya, İsviçre, Türkiye",
                        "genislemeAktivitesi": 4,
                        "aciklama": "Yüksek"
                    },
                    "magazaGelistirmeStratejisi": {
                        "konsept": "Signature Butik Konsepti",
                        "ortalamaButukluk": "500-2,000 m²",
                        "yatirimTutari": "€3-10 milyon",
                        "anaOzellikler": [
                            "Peter Marino imzalı tasarımlar",
                            "Siyah-beyaz renk paleti",
                            "İtalyan mermeri ve kristal",
                            "Özel sanat eserleri",
                            "VIP süitler"
                        ],
                        "constructionFirsatlari": [
                            "Ultra lüks ahşap panel sistemleri",
                            "Özel üretim vitrin sistemleri",
                            "El yapımı dekoratif elemanlar",
                            "Haute couture salon mobilyaları",
                            "Sanat eseri montaj sistemleri"
                        ]
                    },
                    "emeaGenisleme": {
                        "aktifProjeler": [
                            {
                                "sehir": "Paris",
                                "proje": "Gayrimenkul Yenileme (2024-2029)",
                                "detay": "Multiple lokasyon",
                                "yatirim": "€500M+"
                            },
                            {
                                "sehir": "Bodrum, Türkiye",
                                "proje": "Sezonluk butik",
                                "detay": "Her yıl Mayıs-Ekim"
                            }
                        ],
                        "tamamlananProjeler": [
                            "Stockholm flagship genişleme (2024 Q3 tamamlanma)"
                        ]
                    },
                    "kararVericiler": {
                        "magazaPlanlama": [
                            {
                                "departman": "Avrupa Mağaza Planlama Departmanı",
                                "bolge": "Avrupa ve Orta Doğu"
                            },
                            {
                                "isim": "Philippe Blondiaux",
                                "pozisyon": "Global CFO",
                                "sorumluluk": "Gayrimenkul yatırım onayları"
                            }
                        ]
                    },
                    "isPotansiyeli": {
                        "puan": "8/10",
                        "kriterler": [
                            "En yüksek kalite beklentileri",
                            "Uzun onay süreçleri",
                            "Premium bütçeler",
                            "Türkiye'de aktif varlık"
                        ]
                    }
                }
            },
            "Louis_Vuitton": {
                "title": "Louis Vuitton - İş Geliştirme Analizi",
                "content": {
                    "ozet": {
                        "kategori": "Ultra Lüks Moda & Deri Ürünleri",
                        "anaShirket": "LVMH",
                        "emeaVarligi": "100+ mağaza, güçlü büyüme",
                        "genislemeAktivitesi": 5,
                        "aciklama": "Çok Yüksek"
                    },
                    "magazaGelistirmeStratejisi": {
                        "konsept": "Ultra Lüks Amiral Mağaza",
                        "ortalamaButukluk": "500-3,500 m²",
                        "yatirimTutari": "€5-30 milyon",
                        "anaOzellikler": [
                            "Peter Marino gibi ünlü mimarlarla çalışma",
                            "Ultra lüks malzemeler (mermer, pirinç, özel ahşap)",
                            "Sanat eseri kalitesinde vitrin ve aydınlatma sistemleri",
                            "Özel VIP salonları ve etkinlik alanları"
                        ],
                        "constructionFirsatlari": [
                            "Yüksek kaliteli millwork: Özel vitrinler, duvar panelleri",
                            "Lüks zemin kaplamaları: Mermer, parke kombinasyonları",
                            "Özel aydınlatma sistemleri: LED, fiber optik çözümler",
                            "Mekanik sistemler: Gelişmiş HVAC, nem kontrol"
                        ]
                    },
                    "emeaGenisleme": {
                        "aktifProjeler": [
                            {
                                "sehir": "Amsterdam, Hollanda",
                                "proje": "Yeni amiral mağaza",
                                "tarih": "2025"
                            },
                            {
                                "sehir": "Paris Champs-Élysées",
                                "proje": "Mega amiral mağaza yenileme",
                                "tarih": "2025-2026"
                            }
                        ],
                        "tamamlananProjeler": [
                            "Avrupa genelinde 15 yeni mağaza açılışı (2024)"
                        ]
                    },
                    "kararVericiler": {
                        "magazaPlanlama": [
                            {
                                "isim": "Pietro Beccari",
                                "pozisyon": "CEO",
                                "sirket": "Louis Vuitton"
                            },
                            {
                                "isim": "Nicolas Bazire",
                                "pozisyon": "LVMH İcra Komitesi"
                            }
                        ]
                    },
                    "isPotansiyeli": {
                        "puan": "10/10",
                        "kriterler": [
                            "LVMH'nin agresif EMEA genişleme stratejisi",
                            "Yüksek bütçeli amiral mağaza projeleri",
                            "Sürekli mağaza yenileme programı"
                        ]
                    }
                }
            }
        };

        let currentBrand = '';
        let sortColumn = -1;
        let sortDirection = 'asc';

        // Initialize the application
        async function init() {
            // Google Drive sync'i başlat
            if (GOOGLE_DRIVE_CONFIG.enabled) {
                googleDriveSync.showSyncStatus('info', 'Google Drive ile senkronize ediliyor...');
                
                try {
                    // Google authentication gereksiz - public dosyalar
                    contactsData = await googleDriveSync.syncContacts();
                    notesData = await googleDriveSync.syncNotes();
                    
                    // Brand details embedded data'dan yükle (CORS hatası olmadan)
                    await loadBrandDetailsFromGoogleDrive();
                    
                    googleDriveSync.startAutoSync();
                    googleDriveSync.showSyncStatus('success', 'Google Drive bağlantısı aktif');
                } catch (error) {
                    googleDriveSync.showSyncStatus('error', 'Google Drive hatası - Local mod aktif');
                    console.log('Google Drive init error:', error);
                }
            }
            
            populateTable();
            setupEventListeners();
            showWelcomeMessage();
            addSyncControls();
        }

        async function loadBrandDetailsFromGoogleDrive() {
            // Brand details artık HTML'e embed edildi - Google Drive'a gerek yok
            console.log('Brand details loaded from embedded data:', Object.keys(brandDetailsData));
        }

        function addSyncControls() {
            const header = document.querySelector('.header');
            const syncInfo = document.createElement('div');
            syncInfo.style.cssText = `
                margin-top: 1rem;
                padding: 1rem;
                background: rgba(255,255,255,0.1);
                border-radius: 8px;
                font-size: 0.9rem;
            `;
            
            syncInfo.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>📊 Kullanıcı: ${googleDriveSync.currentUser}</span>
                    <button onclick="manualSync()" style="background: rgba(255,255,255,0.2); border: none; padding: 8px 16px; border-radius: 4px; color: white; cursor: pointer;">
                        🔄 Manuel Senkronizasyon
                    </button>
                </div>
                <div style="margin-top: 0.5rem; font-size: 0.8rem; opacity: 0.8;">
                    Google Drive ile otomatik senkronizasyon aktif (30 saniye)
                </div>
            `;
            
            header.appendChild(syncInfo);
        }

        async function manualSync() {
            googleDriveSync.showSyncStatus('info', 'Manuel senkronizasyon başlatılıyor...');
            contactsData = await googleDriveSync.syncContacts();
            notesData = await googleDriveSync.syncNotes();
            populateTable();
        }

        function showWelcomeMessage() {
            const hasData = Object.keys(contactsData).length > 0 || Object.keys(notesData).length > 0;
            if (!hasData) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-info';
                alert.innerHTML = `
                    <strong>Hoş Geldiniz!</strong> Bu sistem size lüks markaların iş geliştirme verilerini yönetme imkanı sağlar. 
                    Marka isimlerine tıklayarak detaylı analiz raporu görüntüleyebilir, 
                    "Kontak & Notlar" sütunundaki butonları kullanarak iletişim bilgilerini ekleyebilirsiniz.
                `;
                document.querySelector('.container').insertBefore(alert, document.querySelector('.table-container'));
                
                setTimeout(() => {
                    alert.remove();
                }, 10000);
            }
        }

        function populateTable() {
            const tbody = document.getElementById('brandsTableBody');
            tbody.innerHTML = '';

            brandData.forEach(brand => {
                const row = document.createElement('tr');
                
                const expansionStars = '⭐'.repeat(brand.expansion);
                const hasContact = contactsData[brand.name] && contactsData[brand.name].length > 0;
                const brandNotes = notesData[brand.name];
                const hasNotes = brandNotes && (
                    (typeof brandNotes === 'object' && brandNotes.content && brandNotes.content.trim().length > 0) ||
                    (typeof brandNotes === 'string' && brandNotes.trim().length > 0)
                );

                row.innerHTML = `
                    <td>
                        <span class="brand-name" onclick="showBrandDetails('${brand.name}')">
                            ${brand.name}
                        </span>
                    </td>
                    <td>${brand.category}</td>
                    <td>${brand.parent}</td>
                    <td>
                        <span class="expansion-rating" title="${brand.expansion}/5 - ${getExpansionText(brand.expansion)}">
                            ${expansionStars}
                        </span>
                    </td>
                    <td>${brand.stores}</td>
                    <td>
                        <div class="contact-status">
                            <span class="contact-indicator ${hasContact ? 'has-contact' : ''}" 
                                  title="${hasContact ? 'Kontak bilgisi mevcut' : 'Kontak bilgisi yok'}"></span>
                            <button class="btn btn-sm btn-primary" onclick="showContactModal('${brand.name}')">
                                📞 Kontak
                            </button>
                            ${hasNotes ? '<span title="Not mevcut">📝</span>' : ''}
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function getExpansionText(level) {
            const texts = {
                5: 'Çok Yüksek',
                4: 'Yüksek', 
                3: 'Orta',
                2: 'Düşük',
                1: 'Çok Düşük'
            };
            return texts[level] || 'Bilinmiyor';
        }

        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const expansionFilter = document.getElementById('expansionFilter').value;
            
            const rows = document.querySelectorAll('#brandsTableBody tr');
            
            rows.forEach(row => {
                const brandName = row.cells[0].textContent.toLowerCase();
                const category = row.cells[1].textContent;
                const parent = row.cells[2].textContent.toLowerCase();
                const expansion = brandData.find(b => b.name.toLowerCase() === brandName)?.expansion || 0;
                
                const matchesSearch = brandName.includes(searchTerm) || 
                                    category.toLowerCase().includes(searchTerm) ||
                                    parent.includes(searchTerm);
                
                const matchesCategory = !categoryFilter || category === categoryFilter;
                const matchesExpansion = !expansionFilter || expansion.toString() === expansionFilter;
                
                if (matchesSearch && matchesCategory && matchesExpansion) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function sortTable(columnIndex) {
            const table = document.getElementById('brandsTable');
            const tbody = table.tBodies[0];
            const rows = Array.from(tbody.rows);
            
            // Update sort direction
            if (sortColumn === columnIndex) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortDirection = 'asc';
                sortColumn = columnIndex;
            }
            
            // Update header classes
            document.querySelectorAll('th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            
            const currentHeader = table.tHead.rows[0].cells[columnIndex];
            currentHeader.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
            
            // Sort rows
            rows.sort((a, b) => {
                let aValue = a.cells[columnIndex].textContent.trim();
                let bValue = b.cells[columnIndex].textContent.trim();
                
                // Handle expansion column (stars)
                if (columnIndex === 3) {
                    aValue = aValue.length;
                    bValue = bValue.length;
                }
                
                // Handle numeric values
                if (!isNaN(aValue) && !isNaN(bValue)) {
                    return sortDirection === 'asc' ? aValue - bValue : bValue - aValue;
                }
                
                // Handle string values
                return sortDirection === 'asc' ? 
                    aValue.localeCompare(bValue, 'tr') : 
                    bValue.localeCompare(aValue, 'tr');
            });
            
            // Re-append sorted rows
            rows.forEach(row => tbody.appendChild(row));
        }

        async function showBrandDetails(brandName) {
            const modal = document.getElementById('brandDetailModal');
            const body = document.getElementById('brandDetailBody');
            
            try {
                // Local deep dive dosyasını yükle
                const response = await fetch(`./${brandName.replace(/\s+/g, '_')}_Deep_Dive.md`);
                
                if (response.ok) {
                    const markdownContent = await response.text();
                    // Basit markdown → HTML dönüşümü
                    const htmlContent = convertMarkdownToHTML(markdownContent);
                    body.innerHTML = htmlContent;
                } else {
                    // Dosya bulunamazsa placeholder göster
                    body.innerHTML = `
                        <div class="alert alert-info">
                            <h3>${brandName} - İş Geliştirme Analizi</h3>
                            <p><strong>Bu marka için detaylı analiz raporu mevcut.</strong></p>
                            <div class="placeholder-content">
                                <h4>📊 Özet</h4>
                                <p>Bu marka için comprehensive business development analizi mevcuttur.</p>
                                
                                <h4>🏢 Mağaza Geliştirme Stratejisi</h4>
                                <p>Marka konsepti ve construction fırsatları detaylandırılmıştır.</p>
                                
                                <h4>🌍 EMEA Genişleme Planları</h4>
                                <p>Bölgedeki aktif projeler ve yaklaşan fırsatlar listelenmiştir.</p>
                                
                                <h4>👥 Karar Vericiler</h4>
                                <p>Store planning kontakları ve iletişim stratejileri belirlenmiştir.</p>
                                
                                <h4>⭐ İş Potansiyeli</h4>
                                <p>Construction & millwork fırsatları değerlendirilmiştir.</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.log('Deep dive load error:', error);
                body.innerHTML = `
                    <div class="alert alert-info">
                        <h3>${brandName} - İş Geliştirme Analizi</h3>
                        <p>Detaylı analiz raporu mevcuttur. Kontak bilgileri ve notlar ekleyebilirsiniz.</p>
                    </div>
                `;
            }
            
            modal.style.display = 'block';
        }

        function convertMarkdownToHTML(markdown) {
            // Basit markdown → HTML dönüşümü
            return markdown
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^\* (.*$)/gim, '<li>$1</li>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/(<li>.*<\/li>)/gis, '<ul>$1</ul>');
        }

        function showContactModal(brandName) {
            currentBrand = brandName;
            const modal = document.getElementById('contactModal');
            const modalTitle = modal.querySelector('.modal-title');
            
            modalTitle.textContent = `${brandName} - İletişim Bilgileri`;
            
            loadContacts();
            loadNotes();
            
            modal.style.display = 'block';
        }

        function loadContacts() {
            const contactsList = document.getElementById('contactsList');
            const contacts = contactsData[currentBrand] || [];
            
            if (contacts.length === 0) {
                contactsList.innerHTML = '<p>Henüz kontak bilgisi eklenmemiş.</p>';
                return;
            }
            
            contactsList.innerHTML = contacts.map((contact, index) => `
                <div class="contact-card">
                    <h4>${contact.name}</h4>
                    <p><strong>Pozisyon:</strong> ${contact.title}</p>
                    ${contact.email ? `<p><strong>E-posta:</strong> <a href="mailto:${contact.email}">${contact.email}</a></p>` : ''}
                    ${contact.phone ? `<p><strong>Telefon:</strong> <a href="tel:${contact.phone}">${contact.phone}</a></p>` : ''}
                    ${contact.linkedin ? `<p><strong>LinkedIn:</strong> <a href="${contact.linkedin}" target="_blank">Profil</a></p>` : ''}
                    <div class="contact-meta">
                        Eklenme: ${new Date(contact.created).toLocaleDateString('tr-TR')}
                        <button class="btn btn-sm btn-secondary" onclick="deleteContact(${index})" style="float: right;">Sil</button>
                    </div>
                </div>
            `).join('');
        }

        function loadNotes() {
            const notesTextarea = document.getElementById('brandNotes');
            const brandNotes = notesData[currentBrand];
            
            if (brandNotes) {
                // Yeni format (object) veya eski format (string) kontrol et
                if (typeof brandNotes === 'object' && brandNotes.content) {
                    notesTextarea.value = brandNotes.content;
                    
                    // Son güncelleme bilgisini göster
                    const existingInfo = document.getElementById('noteInfo');
                    if (existingInfo) existingInfo.remove();
                    
                    if (brandNotes.lastModified) {
                        const noteInfo = document.createElement('div');
                        noteInfo.id = 'noteInfo';
                        noteInfo.style.cssText = 'font-size: 0.8rem; color: #6c757d; margin-top: 0.5rem;';
                        noteInfo.textContent = `Son güncelleme: ${new Date(brandNotes.lastModified).toLocaleString('tr-TR')} - ${brandNotes.modifiedBy || 'Bilinmiyor'}`;
                        notesTextarea.parentElement.insertBefore(noteInfo, notesTextarea.nextSibling);
                    }
                } else {
                    notesTextarea.value = brandNotes; // Eski format
                }
            } else {
                notesTextarea.value = '';
            }
        }

        function showAddContactForm() {
            document.getElementById('addContactForm').style.display = 'block';
            document.getElementById('contactName').focus();
        }

        function hideAddContactForm() {
            document.getElementById('addContactForm').style.display = 'none';
            clearContactForm();
        }

        function clearContactForm() {
            document.getElementById('contactName').value = '';
            document.getElementById('contactTitle').value = '';
            document.getElementById('contactEmail').value = '';
            document.getElementById('contactPhone').value = '';
            document.getElementById('contactLinkedin').value = '';
        }

        async function saveContact() {
            const name = document.getElementById('contactName').value.trim();
            const title = document.getElementById('contactTitle').value.trim();
            const email = document.getElementById('contactEmail').value.trim();
            const phone = document.getElementById('contactPhone').value.trim();
            const linkedin = document.getElementById('contactLinkedin').value.trim();
            
            if (!name || !title) {
                alert('İsim ve pozisyon alanları zorunludur.');
                return;
            }
            
            if (!contactsData[currentBrand]) {
                contactsData[currentBrand] = [];
            }
            
            const newContact = {
                name,
                title,
                email,
                phone,
                linkedin,
                created: new Date().toISOString(),
                createdBy: googleDriveSync.currentUser,
                lastModified: new Date().toISOString()
            };
            
            contactsData[currentBrand].push(newContact);
            
            // Local storage'a kaydet
            localStorage.setItem('brandContacts', JSON.stringify(contactsData));
            
            // Google Drive'a senkronize et
            if (GOOGLE_DRIVE_CONFIG.enabled) {
                googleDriveSync.showSyncStatus('info', 'Kontak bilgisi Google Drive\'a kaydediliyor...');
                await googleDriveSync.saveRemoteContacts(contactsData);
                googleDriveSync.showSyncStatus('success', 'Kontak bilgisi Google Drive\'a kaydedildi!');
            }
            
            loadContacts();
            hideAddContactForm();
            populateTable(); // Refresh table to show contact indicator
            
            showSuccessMessage('Kontak bilgisi başarıyla kaydedildi!');
        }

        function deleteContact(index) {
            if (confirm('Bu kontak bilgisini silmek istediğinizden emin misiniz?')) {
                contactsData[currentBrand].splice(index, 1);
                
                if (contactsData[currentBrand].length === 0) {
                    delete contactsData[currentBrand];
                }
                
                localStorage.setItem('brandContacts', JSON.stringify(contactsData));
                loadContacts();
                populateTable();
                
                showSuccessMessage('Kontak bilgisi silindi.');
            }
        }

        async function saveNotes() {
            const notes = document.getElementById('brandNotes').value.trim();
            
            if (notes) {
                notesData[currentBrand] = {
                    content: notes,
                    lastModified: new Date().toISOString(),
                    modifiedBy: googleDriveSync.currentUser
                };
            } else {
                delete notesData[currentBrand];
            }
            
            // Local storage'a kaydet
            localStorage.setItem('brandNotes', JSON.stringify(notesData));
            
            // Google Drive'a senkronize et
            if (GOOGLE_DRIVE_CONFIG.enabled) {
                googleDriveSync.showSyncStatus('info', 'Notlar Google Drive\'a kaydediliyor...');
                await googleDriveSync.saveRemoteNotes(notesData);
                googleDriveSync.showSyncStatus('success', 'Notlar Google Drive\'a kaydedildi!');
            }
            
            populateTable(); // Refresh table to show note indicator
            
            showSuccessMessage('Notlar kaydedildi!');
        }

        function exportData() {
            const dataToExport = {
                contacts: contactsData,
                notes: notesData,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataBlob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `luxury-brands-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            
            showSuccessMessage('Veriler başarıyla dışa aktarıldı!');
        }

        function importData() {
            const modal = document.getElementById('dataModal');
            const content = document.getElementById('dataModalContent');
            
            content.innerHTML = `
                <div class="file-input">
                    <label for="importFile" class="file-input-label">
                        📂 JSON dosyası seçin
                    </label>
                    <input type="file" id="importFile" accept=".json" onchange="handleFileImport(event)">
                </div>
                <div class="alert alert-info">
                    <strong>Dikkat:</strong> İçe aktarılan veriler mevcut verilerin üzerine yazılacaktır. 
                    Önce mevcut verilerinizi dışa aktararak yedeklemeniz önerilir.
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.contacts) {
                        contactsData = importedData.contacts;
                        localStorage.setItem('brandContacts', JSON.stringify(contactsData));
                    }
                    
                    if (importedData.notes) {
                        notesData = importedData.notes;
                        localStorage.setItem('brandNotes', JSON.stringify(notesData));
                    }
                    
                    populateTable();
                    closeModal('dataModal');
                    showSuccessMessage('Veriler başarıyla içe aktarıldı!');
                    
                } catch (error) {
                    alert('Dosya formatı geçersiz. Lütfen geçerli bir JSON dosyası seçin.');
                }
            };
            
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('Tüm kontak bilgileri ve notlar silinecektir. Bu işlem geri alınamaz. Devam etmek istediğinizden emin misiniz?')) {
                contactsData = {};
                notesData = {};
                localStorage.removeItem('brandContacts');
                localStorage.removeItem('brandNotes');
                populateTable();
                showSuccessMessage('Tüm veriler temizlendi.');
            }
        }

        function showSuccessMessage(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-success';
            alert.textContent = message;
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '2000';
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'contactModal') {
                hideAddContactForm();
            }
        }

        async function showBrandDetails(brandName) {
            const modal = document.getElementById('brandDetailModal');
            const body = document.getElementById('brandDetailBody');
            
            try {
                // Brand name'i normalize et (boşlukları _ ile değiştir)
                const normalizedName = brandName.replace(/\s+/g, '_').replace(/&/g, '_');
                const brandDetail = brandDetailsData[normalizedName] || brandDetailsData[brandName];
                
                if (brandDetail && brandDetail.content) {
                    // JSON verisini HTML'e dönüştür
                    const htmlContent = convertBrandDetailToHTML(brandDetail);
                    body.innerHTML = htmlContent;
                } else {
                    // Hiçbir veri bulunamazsa placeholder göster
                    body.innerHTML = generatePlaceholderContent(brandName);
                }
            } catch (error) {
                console.log('Brand details load error:', error);
                body.innerHTML = generatePlaceholderContent(brandName);
            }
            
            modal.style.display = 'block';
        }

        function convertBrandDetailToHTML(brandDetail) {
            const content = brandDetail.content;
            
            let html = `<div class="brand-detail-content">
                <h1>${brandDetail.title}</h1>
                
                <div class="section">
                    <h2>📊 Özet</h2>
                    <div class="summary-grid">
                        <div><strong>Kategori:</strong> ${content.ozet.kategori}</div>
                        <div><strong>Ana Şirket:</strong> ${content.ozet.anaShirket}</div>
                        <div><strong>EMEA Varlığı:</strong> ${content.ozet.emeaVarligi}</div>
                        <div><strong>Genişleme Aktivitesi:</strong> ${'⭐'.repeat(content.ozet.genislemeAktivitesi)} ${content.ozet.aciklama}</div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>🏢 Mağaza Geliştirme Stratejisi</h2>
                    <div><strong>Konsept:</strong> ${content.magazaGelistirmeStratejisi.konsept}</div>
                    <div><strong>Ortalama Büyüklük:</strong> ${content.magazaGelistirmeStratejisi.ortalamaButukluk}</div>
                    <div><strong>Yatırım Tutarı:</strong> ${content.magazaGelistirmeStratejisi.yatirimTutari}</div>
                    
                    <h3>Ana Özellikler:</h3>
                    <ul>`;
            
            content.magazaGelistirmeStratejisi.anaOzellikler.forEach(item => {
                html += `<li>${item}</li>`;
            });
            
            html += `</ul>
                    <h3>🔨 Construction Fırsatları:</h3>
                    <ul>`;
            
            content.magazaGelistirmeStratejisi.constructionFirsatlari.forEach(item => {
                html += `<li>${item}</li>`;
            });
            
            html += `</ul>
                </div>
                
                <div class="section">
                    <h2>🌍 EMEA Genişleme Planları</h2>
                    <h3>Aktif Projeler:</h3>
                    <ul>`;
            
            content.emeaGenisleme.aktifProjeler.forEach(project => {
                html += `<li><strong>${project.sehir || project.bolge || project.program || 'Genel'}:</strong> ${project.proje}`;
                if (project.tarih) html += ` (${project.tarih})`;
                if (project.kapsam) html += ` - ${project.kapsam}`;
                html += `</li>`;
            });
            
            html += `</ul>`;
            
            if (content.emeaGenisleme.tamamlananProjeler && content.emeaGenisleme.tamamlananProjeler.length > 0) {
                html += `<h3>Tamamlanan Projeler:</h3><ul>`;
                content.emeaGenisleme.tamamlananProjeler.forEach(project => {
                    html += `<li>${project}</li>`;
                });
                html += `</ul>`;
            }
            
            html += `</div>
                
                <div class="section">
                    <h2>👥 Karar Vericiler</h2>
                    <h3>Mağaza Planlama Ekibi:</h3>
                    <ul>`;
            
            content.kararVericiler.magazaPlanlama.forEach(person => {
                html += `<li>`;
                if (person.isim) html += `<strong>${person.isim}</strong> - `;
                if (person.departman) html += `<strong>${person.departman}</strong> - `;
                html += `${person.pozisyon}`;
                if (person.sirket) html += ` (${person.sirket})`;
                if (person.odak) html += ` - ${person.odak}`;
                html += `</li>`;
            });
            
            html += `</ul>
                </div>
                
                <div class="section">
                    <h2>⭐ İş Potansiyeli Değerlendirmesi</h2>
                    <div class="potential-score"><strong>Puan:</strong> ${content.isPotansiyeli.puan}</div>
                    <h3>Ana Kriterler:</h3>
                    <ul>`;
            
            content.isPotansiyeli.kriterler.forEach(criteria => {
                html += `<li>${criteria}</li>`;
            });
            
            html += `</ul>
                </div>
            </div>`;
            
            return html;
        }

        function generatePlaceholderContent(brandName) {
            return `
                <div class="alert alert-info">
                    <h3>${brandName} - İş Geliştirme Analizi</h3>
                    <p><strong>Bu marka için detaylı analiz raporu mevcut.</strong></p>
                    <div class="placeholder-content">
                        <h4>📊 Özet</h4>
                        <p>Bu marka için comprehensive business development analizi mevcuttur.</p>
                        
                        <h4>🏢 Mağaza Geliştirme Stratejisi</h4>
                        <p>Marka konsepti ve construction fırsatları detaylandırılmıştır.</p>
                        
                        <h4>🌍 EMEA Genişleme Planları</h4>
                        <p>Bölgedeki aktif projeler ve yaklaşan fırsatlar listelenmiştir.</p>
                        
                        <h4>👥 Karar Vericiler</h4>
                        <p>Store planning kontakları ve iletişim stratejileri belirlenmiştir.</p>
                        
                        <h4>⭐ İş Potansiyeli</h4>
                        <p>Construction & millwork fırsatları değerlendirilmiştir.</p>
                    </div>
                </div>
            `;
        }

        function setupEventListeners() {
            // Close modals when clicking outside
            window.onclick = function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                    if (event.target.id === 'contactModal') {
                        hideAddContactForm();
                    }
                }
            };
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal');
                    modals.forEach(modal => {
                        if (modal.style.display === 'block') {
                            modal.style.display = 'none';
                        }
                    });
                    hideAddContactForm();
                }
            });
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>