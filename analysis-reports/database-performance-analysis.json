{
  "timestamp": "2025-07-17T07:23:07.340Z",
  "analysis": {
    "rlsPolicyPerformance": {
      "company_owner": {
        "userProfileQueries": {
          "responseTime": 78,
          "recordCount": 10,
          "error": null
        },
        "projectQueries": {
          "responseTime": 118,
          "recordCount": 4,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 196,
          "recordCount": 10,
          "error": null
        },
        "averageResponseTime": 131,
        "policyComplexity": "low"
      },
      "general_manager": {
        "userProfileQueries": {
          "responseTime": 168,
          "recordCount": 2,
          "error": null
        },
        "projectQueries": {
          "responseTime": 244,
          "recordCount": 4,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 411,
          "recordCount": 9,
          "error": null
        },
        "averageResponseTime": 274,
        "policyComplexity": "low"
      },
      "deputy_general_manager": {
        "userProfileQueries": {
          "responseTime": 144,
          "recordCount": 9,
          "error": null
        },
        "projectQueries": {
          "responseTime": 282,
          "recordCount": 3,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 344,
          "recordCount": 9,
          "error": null
        },
        "averageResponseTime": 257,
        "policyComplexity": "low"
      },
      "technical_director": {
        "userProfileQueries": {
          "responseTime": 121,
          "recordCount": 4,
          "error": null
        },
        "projectQueries": {
          "responseTime": 164,
          "recordCount": 6,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 207,
          "recordCount": 5,
          "error": null
        },
        "averageResponseTime": 164,
        "policyComplexity": "low"
      },
      "project_manager": {
        "userProfileQueries": {
          "responseTime": 187,
          "recordCount": 6,
          "error": null
        },
        "projectQueries": {
          "responseTime": 272,
          "recordCount": 2,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 455,
          "recordCount": 8,
          "error": null
        },
        "averageResponseTime": 305,
        "policyComplexity": "low"
      },
      "architect": {
        "userProfileQueries": {
          "responseTime": 138,
          "recordCount": 7,
          "error": null
        },
        "projectQueries": {
          "responseTime": 246,
          "recordCount": 3,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 324,
          "recordCount": 11,
          "error": null
        },
        "averageResponseTime": 236,
        "policyComplexity": "low"
      },
      "technical_engineer": {
        "userProfileQueries": {
          "responseTime": 133,
          "recordCount": 4,
          "error": null
        },
        "projectQueries": {
          "responseTime": 142,
          "recordCount": 1,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 249,
          "recordCount": 5,
          "error": null
        },
        "averageResponseTime": 175,
        "policyComplexity": "low"
      },
      "purchase_director": {
        "userProfileQueries": {
          "responseTime": 171,
          "recordCount": 5,
          "error": null
        },
        "projectQueries": {
          "responseTime": 285,
          "recordCount": 1,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 427,
          "recordCount": 3,
          "error": null
        },
        "averageResponseTime": 294,
        "policyComplexity": "low"
      },
      "purchase_specialist": {
        "userProfileQueries": {
          "responseTime": 108,
          "recordCount": 10,
          "error": null
        },
        "projectQueries": {
          "responseTime": 161,
          "recordCount": 6,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 247,
          "recordCount": 3,
          "error": null
        },
        "averageResponseTime": 172,
        "policyComplexity": "low"
      },
      "field_worker": {
        "userProfileQueries": {
          "responseTime": 383,
          "recordCount": 4,
          "error": null
        },
        "projectQueries": {
          "responseTime": 588,
          "recordCount": 5,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 654,
          "recordCount": 7,
          "error": null
        },
        "averageResponseTime": 542,
        "policyComplexity": "medium"
      },
      "subcontractor": {
        "userProfileQueries": {
          "responseTime": 230,
          "recordCount": 4,
          "error": null
        },
        "projectQueries": {
          "responseTime": 306,
          "recordCount": 3,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 542,
          "recordCount": 14,
          "error": null
        },
        "averageResponseTime": 359,
        "policyComplexity": "low"
      },
      "client": {
        "userProfileQueries": {
          "responseTime": 206,
          "recordCount": 10,
          "error": null
        },
        "projectQueries": {
          "responseTime": 333,
          "recordCount": 4,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 432,
          "recordCount": 9,
          "error": null
        },
        "averageResponseTime": 324,
        "policyComplexity": "low"
      },
      "admin": {
        "userProfileQueries": {
          "responseTime": 110,
          "recordCount": 6,
          "error": null
        },
        "projectQueries": {
          "responseTime": 164,
          "recordCount": 3,
          "error": null
        },
        "scopeItemQueries": {
          "responseTime": 264,
          "recordCount": 9,
          "error": null
        },
        "averageResponseTime": 179,
        "policyComplexity": "low"
      }
    },
    "queryPerformance": {},
    "nPlusOneQueries": [
      {
        "query": "scope_items_with_projects",
        "responseTime": 650,
        "issue": "Potential N+1 query when fetching project data for each scope item",
        "recommendation": "Use proper JOIN or optimize the query structure"
      },
      {
        "query": "projects_with_assignments",
        "responseTime": 920,
        "issue": "Potential N+1 query when fetching user profiles for each assignment",
        "recommendation": "Optimize nested queries or use application-level batching"
      },
      {
        "query": "complex_permission_filtering",
        "responseTime": 1200,
        "issue": "Complex RLS policies causing multiple permission checks per row",
        "recommendation": "Cache permission results or simplify RLS logic"
      }
    ],
    "connectionPooling": {
      "concurrentConnections": 19,
      "averageConnectionTime": 205,
      "connectionErrors": 1,
      "maxConnectionsReached": true,
      "recommendations": [
        {
          "issue": "1 connections failed out of 20",
          "recommendation": "Increase connection pool size or implement connection retry logic"
        },
        {
          "issue": "High average connection time: 205ms",
          "recommendation": "Optimize connection pooling configuration or database location"
        }
      ]
    },
    "roleBasedCostVisibility": {
      "company_owner": {
        "hasAccess": true,
        "responseTime": 216,
        "recordCount": 6,
        "error": null
      },
      "general_manager": {
        "hasAccess": true,
        "responseTime": 267,
        "recordCount": 18,
        "error": null
      },
      "deputy_general_manager": {
        "hasAccess": true,
        "responseTime": 441,
        "recordCount": 9,
        "error": null
      },
      "technical_director": {
        "hasAccess": true,
        "responseTime": 464,
        "recordCount": 18,
        "error": null
      },
      "admin": {
        "hasAccess": true,
        "responseTime": 428,
        "recordCount": 15,
        "error": null
      },
      "technical_engineer": {
        "hasAccess": true,
        "responseTime": 354,
        "recordCount": 16,
        "error": null
      },
      "purchase_director": {
        "hasAccess": true,
        "responseTime": 339,
        "recordCount": 7,
        "error": null
      },
      "purchase_specialist": {
        "hasAccess": true,
        "responseTime": 497,
        "recordCount": 19,
        "error": null
      },
      "project_manager": {
        "hasAccess": false,
        "responseTime": 196,
        "recordCount": 3,
        "error": null
      },
      "architect": {
        "hasAccess": false,
        "responseTime": 238,
        "recordCount": 13,
        "error": null
      },
      "field_worker": {
        "hasAccess": false,
        "responseTime": 255,
        "recordCount": 10,
        "error": null
      },
      "subcontractor": {
        "hasAccess": false,
        "responseTime": 101,
        "recordCount": 14,
        "error": null
      },
      "client": {
        "hasAccess": false,
        "responseTime": 136,
        "recordCount": 8,
        "error": null
      }
    },
    "recommendations": [
      {
        "type": "rls_optimization",
        "role": "field_worker",
        "issue": "Medium RLS policy complexity detected",
        "recommendation": "Consider optimizing RLS policies for better performance",
        "priority": "medium"
      },
      {
        "type": "n_plus_one_optimization",
        "issue": "Found 3 potential N+1 query problems",
        "recommendation": "Optimize queries using proper JOINs, batching, or caching",
        "priority": "high"
      },
      {
        "type": "connection_pooling",
        "issue": "Connection pooling optimization needed",
        "recommendations": [
          {
            "issue": "1 connections failed out of 20",
            "recommendation": "Increase connection pool size or implement connection retry logic"
          },
          {
            "issue": "High average connection time: 205ms",
            "recommendation": "Optimize connection pooling configuration or database location"
          }
        ],
        "priority": "medium"
      },
      {
        "type": "cost_visibility_optimization",
        "issue": "Cost visibility queries are significantly slower than non-cost queries",
        "recommendation": "Consider separating cost data into dedicated tables or views",
        "priority": "medium"
      }
    ]
  },
  "summary": {
    "overallPerformance": "good",
    "overallAvgResponseTime": 262,
    "totalRolesTested": 13,
    "slowRoles": 1,
    "fastRoles": 5,
    "nPlusOneIssues": 3,
    "connectionPoolingIssues": 1,
    "totalRecommendations": 4
  }
}